<link rel="import" href="../components/polymer/polymer.html">

<dom-module id="scene-loading">
	<style>
		#background-img {
			position: absolute;
			top: 0;
			left: 0;
			width: 1920px;
			height: 1080px;

			z-index: -1;
		}
		#blue-team, #red-team {
			position: absolute;
			margin-top: 492px;
			width: 660px;
			height: 80px;

			font-family: octin_sportsregular, sans-serif;
			font-size: 80px;
			background: -webkit-linear-gradient(#FFFFFF, #CACACA);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			-webkit-text-stroke: 1.75px #000000;
			-webkit-font-smoothing: antialiased;
			text-align: center;
		}
		#blue-team { margin-left: 250px; }
		#red-team { margin-left: 1005px; }
	</style>
	<template>
		<div id="background-img">
			<div id="blue-team"></div>
			<div id="red-team"></div>
		</div>
	</template>

</dom-module>

<script>
	Polymer({
		is: "scene-loading",

		ready: function () {
			var game = "";
			var updateTeams = function () {
				if (typeof teamReplicant.value == "undefined" || typeof comingUpReplicant == "undefined" || game == "") { return }
				$.each(teamReplicant.value[game], function (team, value) { // For each team...
					$("#" + team + "-team").text(value["info"]["tag"])
				});
			};

			var currentBG = "";
			var comingUpReplicant = nodecg.Replicant("coming-up")
					.on("change", function (oldVal, newVal) { // On change...
						var colour = (newVal["colour"] == "inhouse") ? "black" : newVal["colour"];
						if (currentBG != colour) {
							$("#background-img").css("background-image", "url(" + preload.getResult(colour + "-loading-bg").src + ")");
							currentBG = newVal["colour"];
						}
						game = newVal["next_game"];
						updateTeams();
					});
			var teamReplicant = nodecg.Replicant("team-data")
					.on("change", function (oldVal, newVal) {
						updateTeams();
					});
		}
	});
</script>
